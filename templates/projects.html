{% extends "base.html" %}
{% block title %}Eleva ERP – Projects{% endblock %}

{% block content %}
<div class="space-y-6">
  <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-inner shadow-black/20">
    <div class="flex flex-wrap items-center gap-4">
      <div>
        <h2 class="text-lg font-semibold text-slate-100">Project Portfolio</h2>
        <p class="text-sm text-slate-400">Manage project metadata and link QC tasks directly to each site.</p>
      </div>
      <div class="ml-auto text-xs text-slate-400 uppercase tracking-wide">
        {{ projects|length }} project{{ '' if projects|length == 1 else 's' }}
      </div>
    </div>
  </div>

  <div class="grid lg:grid-cols-[2fr_1fr] gap-6">
    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-inner shadow-black/20 overflow-auto">
      {% if projects|length == 0 %}
        <p class="text-slate-400 text-sm">No projects yet. Use the form on the right to add one.</p>
      {% else %}
        <table class="min-w-full text-sm">
          <thead class="text-slate-400">
            <tr>
              <th class="text-left py-2 pr-3">Project</th>
              <th class="text-left py-2 pr-3">Site / Customer</th>
              <th class="text-left py-2 pr-3">Lift Type</th>
              <th class="text-left py-2 pr-3">Task Load</th>
              <th class="text-left py-2">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-800">
            {% for project in projects %}
              {% set stats = stats_map.get(project.id, {'open': 0, 'in_progress': 0, 'closed': 0, 'total': 0}) %}
              <tr class="hover:bg-slate-800/40">
                <td class="py-2 pr-3 align-top">
                  <div class="font-semibold text-slate-100">{{ project.name }}</div>
                  <div class="text-xs text-slate-500">Created {{ project.created_at.strftime('%Y-%m-%d') }}</div>
                </td>
                <td class="py-2 pr-3 align-top">
                  <div class="text-slate-200">{{ project.site_name or '—' }}</div>
                  <div class="text-xs text-slate-400">{{ project.customer_name or '—' }}</div>
                </td>
                <td class="py-2 pr-3 align-top text-slate-200">
                  {{ project.lift_type or '—' }}
                </td>
                <td class="py-2 pr-3 align-top">
                  <div class="flex flex-wrap gap-2 text-xs uppercase tracking-wide">
                    <span class="px-2 py-0.5 rounded-lg bg-emerald-500/10 text-emerald-300">Open {{ stats.open }}</span>
                    <span class="px-2 py-0.5 rounded-lg bg-sky-500/10 text-sky-300">In Progress {{ stats.in_progress }}</span>
                    <span class="px-2 py-0.5 rounded-lg bg-slate-800 text-slate-200">Total {{ stats.total }}</span>
                  </div>
                </td>
                <td class="py-2 align-top">
                  <a href="{{ url_for('project_detail', project_id=project.id) }}" class="px-3 py-1.5 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-xs">Open</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>

    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-inner shadow-black/20">
      <h3 class="text-base font-semibold text-slate-100 mb-3">Create Project</h3>
      <form method="post" class="space-y-3">
        <div>
          <label class="block text-xs text-slate-400 uppercase tracking-wide mb-1">Project name</label>
          <input name="name" required class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700" placeholder="Project title" />
        </div>
        <div>
          <label class="block text-xs text-slate-400 uppercase tracking-wide mb-1">Site name</label>
          <input name="site_name" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700" placeholder="Building or campus" />
        </div>
        <div>
          <label class="block text-xs text-slate-400 uppercase tracking-wide mb-1">Site address</label>
          <textarea name="site_address" rows="2" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700" placeholder="Street, city"></textarea>
        </div>
        <div>
          <label class="block text-xs text-slate-400 uppercase tracking-wide mb-1">Customer name</label>
          <input name="customer_name" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700" placeholder="Customer / Builder" />
        </div>
        <div>
          <label class="block text-xs text-slate-400 uppercase tracking-wide mb-1">Lift type</label>
          <select name="lift_type" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700">
            <option value="" selected>Not specified</option>
            {% for lt in LIFT_TYPES %}
              <option value="{{ lt }}">{{ lt }}</option>
            {% endfor %}
          </select>
        </div>
        <button class="w-full px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-sm">Create project</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

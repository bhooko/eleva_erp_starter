<div class="space-y-4">
  {% set type_styles = {
    'general': 'design-task-type',
    'design': 'design-task-type',
    'site_visit': 'design-task-type'
  } %}
  {% set type_labels = {
    'general': 'General Task',
    'design': 'Design Task',
    'site_visit': 'Site Visit Task'
  } %}
  {% set status_styles = {
    'In progress': 'bg-blue-500 text-white',
    'Hold': 'bg-amber-500 text-slate-900',
    'Complete': 'bg-emerald-500 text-white',
    'Cancelled': 'bg-rose-500 text-white',
    'Drawing pending': 'bg-indigo-500 text-white',
    'SRT input': 'bg-violet-500 text-white',
    'Sales input': 'bg-cyan-500 text-white',
    'Sent for approval': 'bg-amber-500 text-slate-900',
    'BOM pending': 'bg-blue-500 text-white',
    'BOM approved': 'bg-emerald-500 text-white',
    'Finalized': 'bg-teal-600 text-white',
    'Delayed': 'bg-rose-500 text-white'
  } %}
  {% set origin_icons = {
    'sales': 'ğŸ’¼',
    'installation': 'ğŸ—ï¸',
    'service': 'ğŸ› ï¸',
    'manual': 'âœï¸'
  } %}

  <section class="border rounded-xl bg-slate-50/60">
    <header class="px-3 py-2 border-b bg-white/80 rounded-t-xl flex items-center justify-between gap-2">
      <h2 class="text-sm font-semibold text-slate-700">Open Tasks</h2>
      <span class="text-xs px-2 py-0.5 rounded-full bg-slate-200 text-slate-700">{{ ordered_tasks|length }}</span>
    </header>
    <div class="p-3 space-y-3">
      {% for task in ordered_tasks %}
        {% set normalized_task_type = 'design' if task.task_type in ['drawing','bom','sales_query'] else task.task_type %}
        {% set task_status_options = status_options_by_type.get(normalized_task_type, status_options_by_type.get('default', [])) %}
        <article class="design-task-card border bg-white rounded-xl p-3 shadow-sm hover:shadow-md transition cursor-pointer" data-task-id="{{ task.id }}" data-status="{{ task.status }}" onclick="window.location='{{ url_for('design_task_detail', task_id=task.id) }}'">
              <div class="flex items-start justify-between gap-2">
                <div class="space-y-1">
                  <div class="flex items-center gap-2 flex-wrap">
                    <span class="px-2 py-1 rounded-full text-xs font-semibold {{ type_styles.get(normalized_task_type, 'design-task-type') }}">{{ type_labels.get(normalized_task_type, normalized_task_type.replace('_',' ').title()) }}</span>
                    <span class="px-2 py-1 rounded-full text-xs font-semibold {{ status_styles.get(task.status, 'bg-slate-500 text-white') }}" data-status-label>{{ statuses.get(task.status, task.status) }}</span>
                    {% if task.has_pending_inputs %}
                      <span class="px-2 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-800">Inputs pending</span>
                    {% endif %}
                  </div>
                  <p class="design-task-title font-semibold leading-tight">{{ task.task_name or task.description or 'Untitled task' }}</p>
                  <p class="text-xs text-muted-contrast">{{ task.project_label or 'Unlinked' }}</p>
                </div>
                <div class="flex flex-col items-end gap-2">
                  {% if can_move_cards %}
                    <select class="design-task-status-select rounded-md px-2 py-1 text-xs" data-status-select data-task-id="{{ task.id }}" data-current-status="{{ task.status }}">
                      {% for status in task_status_options %}
                        <option value="{{ status }}" {% if status == task.status %}selected{% endif %}>{{ statuses.get(status, status) }}</option>
                      {% endfor %}
                    </select>
                  {% endif %}
                  <span class="text-xs text-muted-contrast">DT-{{ '%04d' % task.id }}</span>
                </div>
              </div>
              <div class="mt-3 flex flex-wrap items-center gap-2 text-xs text-muted-contrast">
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full design-task-pill">{{ origin_icons.get(task.origin_type or 'manual', 'âœï¸') }} {{ (task.origin_type or 'manual').title() }}</span>
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full design-task-pill">ğŸ‘¤ {{ task.assigned_to.display_name if task.assigned_to else 'Unassigned' }}</span>
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full {{ 'bg-red-500 text-white' if task.priority=='high' else ('bg-amber-500 text-slate-900' if task.priority=='medium' else 'bg-emerald-500 text-white') }}">âš¡ {{ task.priority.title() }}</span>
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full design-task-pill">ğŸ“… {{ task.due_date or 'No due date' }}</span>
              </div>
            </article>
      {% else %}
        <p class="text-sm text-slate-500">No open design tasks found.</p>
      {% endfor %}
    </div>
  </section>
</div>

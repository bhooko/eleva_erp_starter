{% extends "base.html" %}
{% block title %}Purchase Orders · Eleva ERP{% endblock %}
{% block content %}
<div class="px-6 py-6 space-y-6 overflow-y-auto h-full">
  <div class="flex items-center justify-between">
    <div>
      <p class="text-sm uppercase text-slate-500">Purchase</p>
      <h1 class="text-2xl font-semibold">Purchase Orders</h1>
    </div>
  </div>

  <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-4 space-y-3">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs uppercase text-slate-500">Create PO</p>
        <h2 class="text-lg font-semibold">Quick purchase order</h2>
      </div>
    </div>
    <form method="POST" class="grid grid-cols-1 md:grid-cols-3 gap-3">
      {{ csrf_field() }}
      <label class="space-y-1">
        <span class="text-sm">PO Number</span>
        <input type="text" name="po_number" class="w-full rounded-lg border-slate-200" placeholder="auto" />
      </label>
      <label class="space-y-1">
        <span class="text-sm">Project</span>
        <select name="project_id" class="w-full rounded-lg border-slate-200">
          <option value="">—</option>
          {% for project in projects %}<option value="{{ project.id }}">{{ project.name }}</option>{% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-sm">Vendor</span>
        <select name="vendor_id" class="w-full rounded-lg border-slate-200">
          <option value="">—</option>
          {% for vendor in vendors %}<option value="{{ vendor.id }}">{{ vendor.name }}</option>{% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-sm">Order date</span>
        <input type="date" name="order_date" class="w-full rounded-lg border-slate-200" />
      </label>
      <label class="space-y-1">
        <span class="text-sm">Expected delivery</span>
        <input type="date" name="expected_delivery_date" class="w-full rounded-lg border-slate-200" />
      </label>
      <label class="space-y-1">
        <span class="text-sm">Status</span>
        <select name="status" class="w-full rounded-lg border-slate-200">
          <option value="draft">Draft</option>
          <option value="sent">Sent</option>
          <option value="partially_received">Partially Received</option>
          <option value="closed">Closed</option>
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-sm">Item code</span>
        <input type="text" name="item_code" class="w-full rounded-lg border-slate-200" list="bom-items" />
        <datalist id="bom-items">
          {% for item in bom_items %}
            <option value="{{ item.item_code }}">{{ item.description }}</option>
          {% endfor %}
        </datalist>
      </label>
      <label class="space-y-1">
        <span class="text-sm">Description</span>
        <input type="text" name="description" class="w-full rounded-lg border-slate-200" />
      </label>
      <label class="space-y-1">
        <span class="text-sm">Unit</span>
        <input type="text" name="unit" class="w-full rounded-lg border-slate-200" placeholder="nos" />
      </label>
      <label class="space-y-1">
        <span class="text-sm">Quantity</span>
        <input type="number" step="0.01" name="quantity_ordered" class="w-full rounded-lg border-slate-200" value="1" />
      </label>
      <label class="space-y-1">
        <span class="text-sm">Unit price</span>
        <input type="number" step="0.01" name="unit_price" class="w-full rounded-lg border-slate-200" />
      </label>
      <label class="space-y-1">
        <span class="text-sm">Currency</span>
        <input type="text" name="currency" class="w-full rounded-lg border-slate-200" value="INR" />
      </label>
      <label class="space-y-1 md:col-span-3">
        <span class="text-sm">Notes</span>
        <textarea name="notes" rows="2" class="w-full rounded-lg border-slate-200"></textarea>
      </label>
      <div class="md:col-span-3 flex justify-end">
        <button type="submit" class="px-5 py-2 bg-slate-900 text-white rounded-lg hover:shadow-lg hover:scale-[1.02] transition">Save PO</button>
      </div>
    </form>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    {% for po in pos %}
    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-4 space-y-2 hover:shadow-lg transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs uppercase text-slate-500">{{ po.status|title }}</p>
          <h3 class="text-lg font-semibold">{{ po.po_number }}</h3>
          <p class="text-sm text-slate-500">{{ po.vendor.name if po.vendor else 'No vendor' }}</p>
        </div>
        <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">{{ po.project.name if po.project else 'General' }}</span>
      </div>
      <div class="border-t pt-2 text-sm text-slate-600 space-y-1">
        {% for item in po.items %}
        <p>{{ item.item_code }} · {{ item.quantity_ordered }} {{ item.unit }} @ {{ item.unit_price or 0 }} {{ item.currency }}</p>
        {% else %}
        <p class="text-slate-500">No items.</p>
        {% endfor %}
      </div>
    </div>
    {% else %}
    <p class="text-sm text-slate-500">No purchase orders yet.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}

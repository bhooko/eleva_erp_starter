{% extends "base.html" %}
{% block title %}Eleva ERP â€“ Template {{ template.name }}{% endblock %}

{% block content %}
<div class="space-y-6">
  <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-inner shadow-black/20">
    <div class="flex flex-wrap items-start gap-4 justify-between">
      <div>
        <h2 class="text-lg font-semibold text-slate-100">{{ template.name }}</h2>
        {% if template.description %}
          <p class="text-sm text-slate-400 mt-1">{{ template.description }}</p>
        {% else %}
          <p class="text-sm text-slate-500 mt-1">No description yet. Add one by editing this template in the database.</p>
        {% endif %}
        <p class="text-xs text-slate-500 mt-2">Created {{ template.created_at.strftime('%Y-%m-%d %H:%M') }}{% if template.creator %} by {{ template.creator.display_name }}{% endif %}</p>
      </div>
      <div class="text-right text-xs text-slate-400">
        <div>Default task form: <span class="text-emerald-300">{{ DEFAULT_TASK_FORM_NAME }}</span></div>
        <div class="mt-1">Assign this template from a project detail page.</div>
      </div>
    </div>
  </div>

  <div class="grid xl:grid-cols-[3fr_2fr] gap-6">
    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-inner shadow-black/20">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-base font-semibold text-slate-100">Task Blueprint</h3>
        <span class="text-xs text-slate-400 uppercase tracking-wide">{{ tasks|length }} task{{ '' if tasks|length == 1 else 's' }}</span>
      </div>
      {% if tasks %}
        <div class="space-y-3">
          {% for task in tasks %}
            <div class="rounded-2xl border border-slate-800/60 bg-slate-950/40 p-4">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="text-sm font-semibold text-slate-100">{{ task.name }}</div>
                  {% if task.description %}
                    <p class="text-xs text-slate-400 mt-1">{{ task.description }}</p>
                  {% endif %}
                </div>
                <span class="px-3 py-1 rounded-xl bg-slate-800 text-xs text-slate-300 uppercase tracking-wide">Order {{ task.order_index }}</span>
              </div>
              <div class="mt-3 flex flex-wrap items-center gap-3 text-xs text-slate-400">
                <span class="px-2 py-0.5 rounded-lg bg-slate-800/60 border border-slate-700/60">{{ task.form_template.name if task.form_template else DEFAULT_TASK_FORM_NAME }}</span>
                {% if task.default_assignee %}
                  <span class="px-2 py-0.5 rounded-lg bg-slate-800/60 border border-slate-700/60">Default: {{ task.default_assignee.display_name }}</span>
                {% else %}
                  <span class="px-2 py-0.5 rounded-lg bg-slate-800/60 border border-slate-700/60">Unassigned by default</span>
                {% endif %}
                {% if task.depends_on %}
                  <span class="px-2 py-0.5 rounded-lg bg-amber-500/20 border border-amber-500/50 text-amber-200">Depends on {{ task.depends_on.name }}</span>
                {% else %}
                  <span class="px-2 py-0.5 rounded-lg bg-emerald-500/10 border border-emerald-400/40 text-emerald-200">Starts immediately</span>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-sm text-slate-400">No tasks yet. Add the first blueprint task using the form on the right.</p>
      {% endif %}
    </div>

    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-inner shadow-black/20">
      <h3 class="text-base font-semibold text-slate-100 mb-4">Add Task to Template</h3>
      <form method="post" class="space-y-4">
        <div>
          <label class="block text-xs uppercase tracking-wide text-slate-400 mb-1">Task name</label>
          <input name="name" required class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700 focus:border-emerald-400 focus:outline-none" placeholder="e.g. Kick-off meeting" />
        </div>
        <div>
          <label class="block text-xs uppercase tracking-wide text-slate-400 mb-1">Description</label>
          <textarea name="description" rows="3" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700 focus:border-emerald-400 focus:outline-none" placeholder="Optional context or acceptance criteria"></textarea>
        </div>
        <div class="grid sm:grid-cols-2 gap-3">
          <div>
            <label class="block text-xs uppercase tracking-wide text-slate-400 mb-1">Order</label>
            <input type="number" name="order_index" value="{{ tasks|length + 1 }}" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700 focus:border-emerald-400 focus:outline-none" />
          </div>
          <div>
            <label class="block text-xs uppercase tracking-wide text-slate-400 mb-1">Depends on</label>
            <select name="depends_on_id" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700 focus:border-emerald-400 focus:outline-none">
              <option value="">Independent</option>
              {% for task in tasks %}
                <option value="{{ task.id }}">{{ task.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div>
          <label class="block text-xs uppercase tracking-wide text-slate-400 mb-1">Default assignee</label>
          <select name="default_assignee_id" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700 focus:border-emerald-400 focus:outline-none">
            <option value="">Unassigned</option>
            {% for user in users %}
              <option value="{{ user.id }}">{{ user.display_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-xs uppercase tracking-wide text-slate-400 mb-1">Form template</label>
          <select name="form_template_id" class="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-700 focus:border-emerald-400 focus:outline-none">
            <option value="">Use {{ DEFAULT_TASK_FORM_NAME }}</option>
            {% for form in forms %}
              <option value="{{ form.id }}">{{ form.name }}</option>
            {% endfor %}
          </select>
        </div>
        <button class="w-full px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-sm text-white">Add template task</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

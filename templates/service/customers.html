{% extends "base.html" %}
{% block title %}Eleva ERP – Customers{% endblock %}

{% block content %}
<div class="space-y-8">
  <header class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-theme-primary">Customers</h1>
      <p class="text-sm text-slate-400">Manage every customer record, update account details and review linked lifts.</p>
    </div>
    <div class="flex gap-2">
      <button type="button" data-modal-open="customer-create" class="rounded-xl border border-emerald-500/40 bg-emerald-500/10 px-3 py-2 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/20">Add customer</button>
    </div>
  </header>

  <form method="get" action="{{ url_for('service_customers') }}" class="flex flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-900/60 p-4 sm:flex-row sm:items-center sm:justify-between">
    <label for="customerSearch" class="flex-1">
      <span class="block text-xs font-semibold uppercase tracking-wide text-slate-400">Quick search</span>
      <input id="customerSearch" name="q" value="{{ search_query or '' }}" placeholder="Search by customer code, company, contact or route" class="mt-1 w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2 text-sm text-slate-100 focus:border-emerald-400 focus:outline-none" />
    </label>
    <div class="flex gap-2 pt-1 sm:pt-6">
      <button type="submit" class="rounded-xl border border-emerald-400/40 bg-emerald-400/20 px-4 py-2 text-xs font-semibold text-emerald-100 hover:bg-emerald-400/30">Search</button>
      <a href="{{ url_for('service_customers') }}" class="rounded-xl border border-slate-700/70 px-4 py-2 text-xs text-slate-300 hover:bg-slate-800/70">Reset</a>
    </div>
  </form>

  <div class="rounded-2xl border border-slate-800 bg-slate-900/60">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-800 text-sm">
        <thead class="bg-slate-900/80 text-xs uppercase tracking-wide text-slate-400">
          <tr>
            <th class="px-4 py-3 text-left">Customer Code</th>
            <th class="px-4 py-3 text-left">Company</th>
            <th class="px-4 py-3 text-left">Contact Person</th>
            <th class="px-4 py-3 text-left">Phone</th>
            <th class="px-4 py-3 text-left">Mobile</th>
            <th class="px-4 py-3 text-left">Route</th>
            <th class="px-4 py-3 text-left">Sector</th>
            <th class="px-4 py-3 text-left">Branch</th>
            <th class="px-4 py-3 text-left">City</th>
            <th class="px-4 py-3 text-center">Linked Lifts</th>
            <th class="px-4 py-3 text-left">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-800/80 text-slate-200">
          {% for customer in customers %}
            <tr class="hover:bg-slate-800/40">
              <td class="px-4 py-3 font-semibold text-theme-primary">{{ customer.customer_code }}</td>
              <td class="px-4 py-3">
                <a href="{{ url_for('service_customer_detail', customer_id=customer.id) }}" class="font-semibold text-emerald-200 hover:text-emerald-100">{{ customer.company_name }}</a>
                <div class="text-xs text-slate-400">{{ customer.email or '—' }}</div>
              </td>
              <td class="px-4 py-3">{{ customer.contact_person or '—' }}</td>
              <td class="px-4 py-3">{{ customer.phone or '—' }}</td>
              <td class="px-4 py-3">{{ customer.mobile or '—' }}</td>
              <td class="px-4 py-3">{{ customer.route or '—' }}</td>
              <td class="px-4 py-3">{{ customer.sector or '—' }}</td>
              <td class="px-4 py-3">{{ customer.branch or '—' }}</td>
              <td class="px-4 py-3">{{ customer.city or '—' }}</td>
              <td class="px-4 py-3 text-center font-semibold text-emerald-200">{{ customer.lifts|length }}</td>
              <td class="px-4 py-3">
                <a href="{{ url_for('service_customer_detail', customer_id=customer.id) }}" class="rounded-lg border border-slate-700/70 px-3 py-1 text-xs text-slate-200 hover:bg-slate-800/70">Open</a>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="11" class="px-4 py-6 text-center text-sm text-slate-400">No customers found. Use the <strong class="text-slate-200">Add customer</strong> button to create your first record.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<dialog id="customerCreateModal" class="modal-dialog">
  <form method="post" action="{{ url_for('service_customers_create') }}" class="w-full max-w-3xl space-y-6 rounded-2xl border border-slate-800 bg-slate-900/95 p-6 text-sm text-slate-100">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h2 class="text-lg font-semibold text-theme-primary">Create customer</h2>
        <p class="text-xs text-slate-400">Capture billing details and routing information for a new customer.</p>
      </div>
      <button type="button" data-modal-close class="rounded-full border border-slate-700/70 px-3 py-1 text-xs text-slate-300 hover:bg-slate-800/70">Close</button>
    </div>
    <input type="hidden" name="next" value="{{ request.full_path }}" />
    <div class="grid gap-4 md:grid-cols-2">
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Customer code</span>
        <input name="customer_code" required class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="CUS0006" />
      </label>
      <label class="space-y-1 md:col-span-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Company name</span>
        <input name="company_name" required class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Acme Pvt. Ltd." />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Contact person</span>
        <input name="contact_person" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Email</span>
        <input type="email" name="email" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Phone</span>
        <input name="phone" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Landline" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Mobile</span>
        <input name="mobile" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Primary contact" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">GST number</span>
        <input name="gst_no" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Route</span>
        <input name="route" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="R1 / R2 / M1" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Sector</span>
        <input name="sector" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Residential / Commercial" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Branch</span>
        <input name="branch" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Goa / Mumbai" />
      </label>
    </div>
    <div class="grid gap-4 md:grid-cols-2">
      <label class="space-y-1 md:col-span-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Billing address line 1</span>
        <input name="billing_address_line1" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1 md:col-span-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Billing address line 2</span>
        <input name="billing_address_line2" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">City</span>
        <input name="city" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">State</span>
        <input name="state" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Pincode</span>
        <input name="pincode" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Country</span>
        <input name="country" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" value="India" />
      </label>
    </div>
    <label class="space-y-1">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Notes</span>
      <textarea name="notes" rows="3" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2"></textarea>
    </label>
    <div class="flex items-center justify-end gap-2">
      <button type="submit" class="rounded-xl border border-emerald-500/40 bg-emerald-500/20 px-4 py-2 text-xs font-semibold text-emerald-100 hover:bg-emerald-500/30">Create customer</button>
    </div>
  </form>
</dialog>

<script>
  (function() {
    const modal = document.getElementById('customerCreateModal');
    if (!modal) return;
    document.querySelectorAll('[data-modal-open="customer-create"]').forEach((button) => {
      button.addEventListener('click', () => {
        if (typeof modal.showModal === 'function') {
          modal.showModal();
        } else {
          modal.classList.add('open');
        }
      });
    });
    modal.querySelectorAll('[data-modal-close]').forEach((button) => {
      button.addEventListener('click', () => {
        if (typeof modal.close === 'function') {
          modal.close();
        } else {
          modal.classList.remove('open');
        }
      });
    });
  })();
</script>
{% endblock %}

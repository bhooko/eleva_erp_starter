{% extends "base.html" %}
{% block title %}Service Contracts · Eleva ERP{% endblock %}
{% block content %}
{% set current_sort = current_sort or "" %}
{% set current_order = current_order or "asc" %}
{% set sort_query_args = sort_query_args or {} %}
<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-theme-primary">Service Contracts</h1>
      <p class="text-sm text-slate-400">Create and manage AMC contracts.</p>
    </div>
    <a href="{{ url_for('service_contract_new') }}" class="rounded-xl border border-emerald-500/40 bg-emerald-500/10 px-3 py-2 text-xs font-semibold text-emerald-200">New contract</a>
  </div>

  <section class="rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden">
    <table class="min-w-full text-sm text-slate-200">
      <thead class="bg-slate-900/70 text-xs uppercase tracking-wide text-slate-400">
        <tr><th class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='id', order='desc' if current_sort == 'id' and current_order == 'asc' else 'asc', **sort_query_args) }}">#{% if current_sort == 'id' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th><th class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='customer', order='desc' if current_sort == 'customer' and current_order == 'asc' else 'asc', **sort_query_args) }}">Customer{% if current_sort == 'customer' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th><th class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='lift', order='desc' if current_sort == 'lift' and current_order == 'asc' else 'asc', **sort_query_args) }}">Lift{% if current_sort == 'lift' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th><th class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='type', order='desc' if current_sort == 'type' and current_order == 'asc' else 'asc', **sort_query_args) }}">Type{% if current_sort == 'type' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th><th class="px-4 py-3 text-left">Period</th><th class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='price', order='desc' if current_sort == 'price' and current_order == 'asc' else 'asc', **sort_query_args) }}">Final price{% if current_sort == 'price' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th><th class="px-4 py-3 text-left">Actions</th></tr>
      </thead>
      <tbody>
        {% for contract in contracts %}
          <tr class="border-t border-slate-800/70">
            <td class="px-4 py-3">{{ contract.id }}</td>
            <td class="px-4 py-3">{{ contract.customer_name or '—' }}</td>
            <td class="px-4 py-3">{{ contract.lift.lift_code if contract.lift else '—' }}</td>
            <td class="px-4 py-3">{{ contract_type_labels.get(contract.contract_type, contract.contract_type or '—') }}</td>
            <td class="px-4 py-3">{{ contract.start_date.strftime('%d %b %Y') if contract.start_date else '—' }} → {{ contract.end_date.strftime('%d %b %Y') if contract.end_date else '—' }}</td>
            <td class="px-4 py-3">₹ {{ '%.2f'|format(contract.final_price or 0) }}</td>
            <td class="px-4 py-3"><a href="{{ url_for('service_contract_edit', contract_id=contract.id) }}" class="text-emerald-200">Edit</a> · <a href="{{ url_for('service_contract_preview', contract_id=contract.id) }}" class="text-cyan-200">Preview</a></td>
          </tr>
        {% else %}
          <tr><td colspan="7" class="px-4 py-8 text-center text-slate-500">No contracts found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>
{% endblock %}

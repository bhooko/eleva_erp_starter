{% extends "base.html" %}
{% block title %}Eleva ERP – Lifts{% endblock %}

{% block content %}
<div class="space-y-8">
  <header class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-theme-primary">Lifts</h1>
      <p class="text-sm text-slate-400">Catalogue every lift with technical specifications, AMC status and service cadence.</p>
    </div>
    <div class="flex gap-2">
      <button type="button" class="rounded-xl border border-slate-700/70 bg-slate-800/70 px-3 py-2 text-xs text-slate-300 hover:text-white">Upload asset register</button>
      <button type="button" data-modal-open="lift-create" class="rounded-xl border border-emerald-500/40 bg-emerald-500/10 px-3 py-2 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/20">Add lift</button>
    </div>
  </header>

  <form method="get" action="{{ url_for('service_lifts') }}" class="flex flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-900/60 p-4 sm:flex-row sm:items-center sm:justify-between">
    <label for="liftSearch" class="flex-1">
      <span class="block text-xs font-semibold uppercase tracking-wide text-slate-400">Quick search</span>
      <input id="liftSearch" name="q" value="{{ search_query or '' }}" placeholder="Search by lift code, customer, city or status" class="mt-1 w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2 text-sm text-slate-100 focus:border-emerald-400 focus:outline-none" />
    </label>
    <div class="flex gap-2 pt-1 sm:pt-6">
      <button type="submit" class="rounded-xl border border-emerald-400/40 bg-emerald-400/20 px-4 py-2 text-xs font-semibold text-emerald-100 hover:bg-emerald-400/30">Search</button>
      <a href="{{ url_for('service_lifts') }}" class="rounded-xl border border-slate-700/70 px-4 py-2 text-xs text-slate-300 hover:bg-slate-800/70">Reset</a>
    </div>
  </form>

  <div class="rounded-2xl border border-slate-800 bg-slate-900/60">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-800 text-sm">
        <thead class="bg-slate-900/80 text-xs uppercase tracking-wide text-slate-400">
          <tr>
            <th class="px-4 py-3 text-left">Lift code</th>
            <th class="px-4 py-3 text-left">Customer</th>
            <th class="px-4 py-3 text-left">Type</th>
            <th class="px-4 py-3 text-left">Route</th>
            <th class="px-4 py-3 text-left">City</th>
            <th class="px-4 py-3 text-left">Status</th>
            <th class="px-4 py-3 text-left">Install date</th>
            <th class="px-4 py-3 text-left">Last service</th>
            <th class="px-4 py-3 text-left">Next due</th>
            <th class="px-4 py-3 text-left">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-800/80 text-slate-200">
          {% for lift in lifts %}
            <tr class="hover:bg-slate-800/40">
              <td class="px-4 py-3 font-semibold text-theme-primary">
                <a href="{{ url_for('service_lift_detail', lift_id=lift.id) }}" class="text-left font-semibold text-theme-primary transition hover:text-emerald-200">{{ lift.lift_code }}</a>
              </td>
              <td class="px-4 py-3">
                {% if lift.customer %}
                  <a href="{{ url_for('service_customer_detail', customer_id=lift.customer.id) }}" class="font-semibold text-emerald-200 hover:text-emerald-100">{{ lift.customer.company_name }}</a>
                  <div class="text-xs text-slate-400">{{ lift.customer.customer_code }}</div>
                {% else %}
                  <span class="text-xs text-slate-400">Unlinked</span>
                {% endif %}
              </td>
              <td class="px-4 py-3">{{ lift.lift_type or '—' }}</td>
              <td class="px-4 py-3">{{ lift.route or '—' }}</td>
              <td class="px-4 py-3">{{ lift.city or '—' }}</td>
              <td class="px-4 py-3">{{ lift.status or '—' }}</td>
              <td class="px-4 py-3">{{ lift.install_date.strftime('%d %b %Y') if lift.install_date else '—' }}</td>
              <td class="px-4 py-3">{{ lift.last_service_date.strftime('%d %b %Y') if lift.last_service_date else '—' }}</td>
              <td class="px-4 py-3">{{ lift.next_service_due.strftime('%d %b %Y') if lift.next_service_due else '—' }}</td>
              <td class="px-4 py-3">
                <div class="flex flex-wrap gap-2">
                  <a href="{{ url_for('service_lift_detail', lift_id=lift.id) }}" class="rounded-lg border border-emerald-500/40 bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-200 transition hover:bg-emerald-500/20">View</a>
                  <a href="{{ url_for('service_lift_edit', lift_id=lift.id) }}" class="rounded-lg border border-slate-700/70 px-3 py-1 text-xs text-slate-200 transition hover:bg-slate-800/70">Edit</a>
                </div>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="10" class="px-4 py-6 text-center text-sm text-slate-400">No lifts available yet. Use the <strong class="text-slate-200">Add lift</strong> button to register a lift.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<dialog id="liftCreateModal" class="modal-dialog">
  <form method="post" action="{{ url_for('service_lifts_create') }}" class="w-full max-w-4xl space-y-6 rounded-2xl border border-slate-800 bg-slate-900/95 p-6 text-sm text-slate-100">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h2 class="text-lg font-semibold text-theme-primary">Create lift</h2>
        <p class="text-xs text-slate-400">Add installation details and link the lift to a customer.</p>
      </div>
      <div class="flex gap-2">
        <button type="button" data-modal-open="customer-create-from-lift" class="rounded-xl border border-slate-700/70 px-3 py-1 text-xs text-slate-300 hover:bg-slate-800/70">New customer</button>
        <button type="button" data-modal-close class="rounded-full border border-slate-700/70 px-3 py-1 text-xs text-slate-300 hover:bg-slate-800/70">Close</button>
      </div>
    </div>
    <input type="hidden" name="next" value="{{ request.full_path }}" />
    <div class="grid gap-4 md:grid-cols-2">
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Lift code</span>
        <input value="{{ next_lift_code }}" readonly class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2 text-slate-300" />
        <p class="text-[11px] text-slate-500">Automatically generated when you save.</p>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">External lift ID</span>
        <input name="external_lift_id" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1 md:col-span-2">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Customer name</span>
        <input name="customer_name" list="customerNameOptions" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Select customer" />
        <datalist id="customerNameOptions">
          {% for customer in customers %}
            <option value="{{ customer.company_name }}" label="{{ customer.customer_code }}"></option>
          {% endfor %}
        </datalist>
        <p class="text-xs text-slate-500">Start typing a customer name to filter the list or use the "New customer" button to create one.</p>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Site address line 1</span>
        <input name="site_address_line1" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Site address line 2</span>
        <input name="site_address_line2" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">City</span>
        <input name="city" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">State</span>
        <input name="state" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Pincode</span>
        <input name="pincode" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Route</span>
        <select name="route" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select route</option>
          {% for route in service_routes %}
            <option value="{{ route.state }}">{{ route.display_name }}</option>
          {% endfor %}
        </select>
        {% if not service_routes %}
          <p class="text-[11px] text-slate-500">Add routes from Settings → Module Settings to see them here.</p>
        {% endif %}
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Building floors</span>
        <input name="building_floors" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="G+4" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Lift type</span>
        {% set selected_lift_type = request.form.get('lift_type') or '' %}
        <select name="lift_type" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select lift type</option>
          {% for option in LIFT_TYPE_OPTIONS %}
            <option value="{{ option }}" {% if selected_lift_type and selected_lift_type.lower() == option.lower() %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Capacity (persons)</span>
        {% set selected_capacity = request.form.get('capacity_persons') or '' %}
        <select name="capacity_persons" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          {% for value, label in LIFT_CAPACITY_PERSON_OPTIONS %}
            <option value="{{ value }}" {% if selected_capacity == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Capacity (kg)</span>
        <input name="capacity_kg" type="number" min="0" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Speed (m/s)</span>
        <input name="speed_mps" step="0.01" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Machine type</span>
        {% set selected_machine_type = request.form.get('machine_type') or '' %}
        <select name="machine_type" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select machine type</option>
          {% for option in MACHINE_TYPE_OPTIONS %}
            <option value="{{ option }}" {% if selected_machine_type and selected_machine_type.lower() == option.lower() %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Machine brand</span>
        <input name="machine_brand" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Controller brand</span>
        <input name="controller_brand" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Door type</span>
        {% set selected_door_type = request.form.get('door_type') or '' %}
        <select name="door_type" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select door type</option>
          {% for option in DOOR_TYPE_OPTIONS %}
            <option value="{{ option }}" {% if selected_door_type and selected_door_type.lower() == option.lower() %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Door finish</span>
        {% set selected_door_finish = request.form.get('door_brand') or '' %}
        <select name="door_brand" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select door finish</option>
          {% for option in DOOR_FINISH_OPTIONS %}
            <option value="{{ option }}" {% if selected_door_finish and selected_door_finish.lower() == option.lower() %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Cabin finish</span>
        <input name="cabin_finish" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="SS / Glass" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Power supply</span>
        {% set selected_power_supply = request.form.get('power_supply') or '' %}
        <select name="power_supply" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select power supply</option>
          {% for option in POWER_SUPPLY_OPTIONS %}
            <option value="{{ option }}" {% if selected_power_supply and selected_power_supply.lower() == option.lower() %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Install date</span>
        <input type="date" name="install_date" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Warranty expiry</span>
        <input type="date" name="warranty_expiry" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">AMC status</span>
        {% set selected_amc_status = request.form.get('amc_status') or '' %}
        <select name="amc_status" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select AMC status</option>
          {% for option in AMC_STATUS_OPTIONS %}
            <option value="{{ option }}" {% if selected_amc_status and selected_amc_status.lower() == option.lower() %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">AMC start</span>
        <input type="date" name="amc_start" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">AMC duration</span>
        <select name="amc_duration_years" id="liftAmcDuration" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select duration</option>
          {% for years in range(1, 6) %}
            <option value="{{ years }}">{{ years }} year{% if years > 1 %}s{% endif %}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">AMC end</span>
        <input type="date" name="amc_end" id="liftAmcEnd" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" readonly />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">AMC contract</span>
        {% set selected_contract = request.form.get('amc_contract_id') or '' %}
        <select name="amc_contract_id" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">No contract linked</option>
          {% for contract in service_contracts %}
            <option value="{{ contract.id }}" {% if selected_contract and selected_contract.lower() == contract.id.lower() %}selected{% endif %}>{{ contract.id }} · {{ contract.type }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">QR code URL</span>
        <input type="url" name="qr_code_url" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Lift status</span>
        {% set selected_lift_status = request.form.get('status') or '' %}
        <select name="status" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">Select lift status</option>
          {% for option in LIFT_STATUS_OPTIONS %}
            <option value="{{ option }}" {% if selected_lift_status and selected_lift_status.lower() == option.lower() %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Last service date</span>
        <input type="date" name="last_service_date" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Next service due</span>
        <input type="date" name="next_service_due" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Preferred service date</span>
        <select name="preferred_service_date" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">No preference</option>
          {% for day in range(1, 31) %}
            {% set day_value = "%02d" % day %}
            <option value="{{ day_value }}">{{ day_value }}</option>
          {% endfor %}
        </select>
        <p class="text-[11px] text-slate-500">Pick a day of the month (01-30).</p>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Preferred service day</span>
        {% set selected_day = request.form.get('preferred_service_day') or '' %}
        <select name="preferred_service_day" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">
          <option value="">No preference</option>
          {% for value, label in service_day_options %}
            {% if value %}
              <option value="{{ value }}" {% if selected_day and selected_day.lower() == value %}selected{% endif %}>{{ label }}</option>
            {% endif %}
          {% endfor %}
        </select>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Preferred service time</span>
        <input type="time" name="preferred_service_time" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
    </div>
    <label class="space-y-1">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Remarks</span>
      <textarea name="remarks" rows="2" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Add quick remarks or reminders"></textarea>
    </label>
    <label class="space-y-1">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Notes</span>
      <textarea name="notes" rows="3" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2"></textarea>
    </label>
    <div class="flex items-center justify-end gap-2">
      <button type="submit" class="rounded-xl border border-emerald-500/40 bg-emerald-500/20 px-4 py-2 text-xs font-semibold text-emerald-100 hover:bg-emerald-500/30">Create lift</button>
    </div>
  </form>
</dialog>

<dialog id="customerFromLiftModal" class="modal-dialog">
  <form method="post" action="{{ url_for('service_customers_create') }}" class="w-full max-w-3xl space-y-6 rounded-2xl border border-slate-800 bg-slate-900/95 p-6 text-sm text-slate-100">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h2 class="text-lg font-semibold text-theme-primary">Create customer</h2>
        <p class="text-xs text-slate-400">Quickly add a customer without leaving the lift workflow.</p>
      </div>
      <button type="button" data-modal-close class="rounded-full border border-slate-700/70 px-3 py-1 text-xs text-slate-300 hover:bg-slate-800/70">Close</button>
    </div>
    <input type="hidden" name="next" value="{{ url_for('service_lifts') }}" />
    <div class="grid gap-4 md:grid-cols-2">
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Customer code</span>
        <input value="{{ next_customer_code }}" readonly class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2 text-slate-300" />
        <p class="text-[11px] text-slate-500">Automatically generated on save.</p>
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Company name</span>
        <input name="company_name" required class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Acme Pvt. Ltd." />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Contact person</span>
        <input name="contact_person" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Email</span>
        <input type="email" name="email" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Phone</span>
        <input name="phone" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Mobile</span>
        <input name="mobile" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
      </label>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Sector</span>
        <input name="sector" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" placeholder="Residential / Commercial" />
      </label>
    </div>
    <label class="space-y-1">
      <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Notes</span>
      <textarea name="notes" rows="3" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2"></textarea>
    </label>
    <div class="flex items-center justify-end gap-2">
      <button type="submit" class="rounded-xl border border-emerald-500/40 bg-emerald-500/20 px-4 py-2 text-xs font-semibold text-emerald-100 hover:bg-emerald-500/30">Create customer</button>
    </div>
  </form>
</dialog>

<script>
  (function() {
    function setupModal(openSelector, modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) return;
      document.querySelectorAll(openSelector).forEach((trigger) => {
        trigger.addEventListener('click', () => {
          if (typeof modal.showModal === 'function') {
            modal.showModal();
          } else {
            modal.classList.add('open');
          }
        });
      });
      modal.querySelectorAll('[data-modal-close]').forEach((button) => {
        button.addEventListener('click', () => {
          if (typeof modal.close === 'function') {
            modal.close();
          } else {
            modal.classList.remove('open');
          }
        });
      });
    }
    setupModal('[data-modal-open="lift-create"]', 'liftCreateModal');
    setupModal('[data-modal-open="customer-create-from-lift"]', 'customerFromLiftModal');

    const amcStartInput = document.querySelector('input[name="amc_start"]');
    const amcDurationSelect = document.getElementById('liftAmcDuration');
    const amcEndInput = document.getElementById('liftAmcEnd');

    function updateAmcEndDate() {
      if (!amcStartInput || !amcDurationSelect || !amcEndInput) return;
      const startValue = amcStartInput.value;
      const years = parseInt(amcDurationSelect.value, 10);
      if (!startValue || Number.isNaN(years)) {
        amcEndInput.value = '';
        return;
      }
      const parts = startValue.split('-').map((part) => parseInt(part, 10));
      if (parts.length !== 3 || parts.some((part) => Number.isNaN(part))) {
        amcEndInput.value = '';
        return;
      }
      const [year, month, day] = parts;
      const endDate = new Date(Date.UTC(year, month - 1, day));
      endDate.setUTCFullYear(endDate.getUTCFullYear() + years);
      endDate.setUTCDate(endDate.getUTCDate() - 1);
      const isoValue = endDate.toISOString().slice(0, 10);
      amcEndInput.value = isoValue;
    }

    if (amcStartInput && amcDurationSelect) {
      amcStartInput.addEventListener('change', updateAmcEndDate);
      amcDurationSelect.addEventListener('change', updateAmcEndDate);
    }
  })();
</script>
{% endblock %}

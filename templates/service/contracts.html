{% extends "base.html" %}
{% block title %}Eleva ERP – Service Contracts{% endblock %}

{% block content %}
<div class="space-y-8">
  <header class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-theme-primary">Contracts (AMC / Warranty)</h1>
      <p class="text-sm text-slate-400">Track coverage, visit cadence, SLA matrix and renewal follow-ups with billing hooks.</p>
    </div>
    <div class="flex gap-2">
      {% if current_user.is_admin %}
        <a
          href="{{ url_for('service_contracts_export') }}"
          class="rounded-xl border border-slate-700/70 bg-slate-800/70 px-3 py-2 text-xs text-slate-300 hover:text-white"
        >
          Export contracts
        </a>
      {% endif %}
      <button type="button" class="rounded-xl border border-slate-700/70 bg-slate-800/70 px-3 py-2 text-xs text-slate-300 hover:text-white">Configure SLA matrix</button>
      <button type="button" class="rounded-xl border border-emerald-500/40 bg-emerald-500/10 px-3 py-2 text-xs font-semibold text-emerald-200">Add contract</button>
    </div>
  </header>

  <section class="rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden">
    <table class="min-w-full divide-y divide-slate-800/70 text-sm">
      <thead class="bg-slate-900/80 text-xs uppercase tracking-wide text-slate-400">
        <tr class="text-left">
          <th class="px-6 py-3">Contract ID</th>
          <th class="px-6 py-3">Type</th>
          <th class="px-6 py-3">Coverage</th>
          <th class="px-6 py-3">Start</th>
          <th class="px-6 py-3">End</th>
          <th class="px-6 py-3">Visit frequency</th>
          <th class="px-6 py-3">SLA matrix</th>
          <th class="px-6 py-3">Renewal tracker</th>
          <th class="px-6 py-3">Billing hooks</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-800/70 text-slate-200">
        {% for contract in contracts %}
          <tr id="contract-{{ contract.id }}">
            <td class="px-6 py-4 font-semibold text-theme-primary">{{ contract.id }}</td>
            <td class="px-6 py-4">{{ contract.type }}</td>
            <td class="px-6 py-4">{{ contract.coverage }}</td>
            <td class="px-6 py-4 text-xs text-slate-300">{{ contract.start_display }}</td>
            <td class="px-6 py-4 text-xs text-slate-300">{{ contract.end_display }}</td>
            <td class="px-6 py-4">{{ contract.visits }}</td>
            <td class="px-6 py-4 text-xs text-slate-300">{{ contract.sla }}</td>
            <td class="px-6 py-4 text-xs text-amber-300">Renew on {{ contract.renewal_display }}</td>
            <td class="px-6 py-4 text-xs text-slate-300">
              {% if contract.pending_invoices %}
                Pending invoices: <span class="font-semibold text-rose-300">{{ contract.pending_invoices }}</span>
              {% else %}
                <span class="text-emerald-300">All clear</span>
              {% endif %}
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="9" class="px-6 py-8 text-center text-sm text-slate-400">No contracts configured.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="grid gap-6 lg:grid-cols-2">
    <article class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
      <h2 class="text-base font-semibold text-slate-100">Renewal workflow</h2>
      <ul class="mt-3 space-y-2 text-sm text-slate-300">
        <li>• Renewal reminders trigger 60/30/15 days prior with follow-up assignments.</li>
        <li>• Visit planner ties contract frequency into preventive maintenance calendar automatically.</li>
        <li>• SLA breach matrix surfaces to Customer Support for escalations.</li>
      </ul>
    </article>
    <article class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
      <h2 class="text-base font-semibold text-slate-100">Billing hooks</h2>
      <ul class="mt-3 space-y-2 text-sm text-slate-300">
        <li>• Future-ready integration to accounting for invoice linkage and payment follow-ups.</li>
        <li>• Preventive visits auto-propose AMC billing while non-AMC conversions alert Sales for estimates.</li>
        <li>• Pending amount snapshot surfaces at contract level for service managers.</li>
      </ul>
    </article>
  </section>
</div>
{% endblock %}

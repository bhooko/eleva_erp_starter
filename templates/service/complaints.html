{% extends "base.html" %}
{% block title %}Eleva ERP – All Complaints{% endblock %}

{% block content %}
{% set current_sort = current_sort or "" %}
{% set current_order = current_order or "asc" %}
{% set sort_query_args = sort_query_args or {} %}
<div class="space-y-8">
  <header class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-theme-primary">All complaints</h1>
      <p class="text-sm text-slate-400">Centralized listing of every complaint escalated to Service, ready for triage or follow-up.</p>
    </div>
    <div class="flex gap-2">
      <button type="button" class="rounded-xl border border-slate-700/70 bg-slate-800/70 px-3 py-2 text-xs text-slate-300 hover:text-white">Filter categories</button>
      <button type="button" class="rounded-xl border border-emerald-500/40 bg-emerald-500/10 px-3 py-2 text-xs font-semibold text-emerald-200">Download log</button>
    </div>
  </header>

  <section class="rounded-2xl border border-slate-800 bg-slate-900/60">
    <div class="border-b border-slate-800/70 px-6 py-4">
      <h2 class="text-base font-semibold text-slate-100">Complaints register</h2>
      <p class="text-xs text-slate-400">Monitor intake status, location context and conversion progress for every complaint handed to Service.</p>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-800 text-sm">
        <thead class="bg-slate-900/80 text-xs uppercase tracking-wide text-slate-400">
          <tr>
            <th scope="col" class="px-6 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='id', order='desc' if current_sort == 'id' and current_order == 'asc' else 'asc', **sort_query_args) }}">Complaint ID{% if current_sort == 'id' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th>
            <th scope="col" class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='source', order='desc' if current_sort == 'source' and current_order == 'asc' else 'asc', **sort_query_args) }}">Source{% if current_sort == 'source' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th>
            <th scope="col" class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='category', order='desc' if current_sort == 'category' and current_order == 'asc' else 'asc', **sort_query_args) }}">Category{% if current_sort == 'category' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th>
            <th scope="col" class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='priority', order='desc' if current_sort == 'priority' and current_order == 'asc' else 'asc', **sort_query_args) }}">Priority{% if current_sort == 'priority' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th>
            <th scope="col" class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='location', order='desc' if current_sort == 'location' and current_order == 'asc' else 'asc', **sort_query_args) }}">Location{% if current_sort == 'location' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th>
            <th scope="col" class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='lift', order='desc' if current_sort == 'lift' and current_order == 'asc' else 'asc', **sort_query_args) }}">Lift{% if current_sort == 'lift' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th>
            <th scope="col" class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='status', order='desc' if current_sort == 'status' and current_order == 'asc' else 'asc', **sort_query_args) }}">Status{% if current_sort == 'status' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th>
            <th scope="col" class="px-4 py-3 text-left"><a class="hover:text-emerald-200" href="{{ url_for(request.endpoint, sort='linked_task', order='desc' if current_sort == 'linked_task' and current_order == 'asc' else 'asc', **sort_query_args) }}">Linked task{% if current_sort == 'linked_task' %} {{ '▲' if current_order == 'asc' else '▼' }}{% endif %}</a></th>
            <th scope="col" class="px-4 py-3 text-left">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-800/70 text-slate-200">
          {% for complaint in complaints %}
            <tr class="hover:bg-slate-800/40">
              <td class="px-6 py-4 font-semibold text-theme-primary">{{ complaint.id }}</td>
              <td class="px-4 py-4">
                <span class="text-xs uppercase tracking-wide text-slate-500">{{ complaint.source }}</span>
              </td>
              <td class="px-4 py-4">{{ complaint.category }}</td>
              <td class="px-4 py-4">
                <span class="inline-flex items-center rounded-full border border-slate-700/70 bg-slate-800/70 px-2 py-0.5 text-xs text-slate-200">{{ complaint.priority }}</span>
              </td>
              <td class="px-4 py-4">{{ complaint.location }}</td>
              <td class="px-4 py-4">{{ complaint.lift }}</td>
              <td class="px-4 py-4">
                <span class="font-semibold text-theme-primary">{{ complaint.status }}</span>
              </td>
              <td class="px-4 py-4">
                {% if complaint.linked_task %}
                  <span class="font-semibold text-emerald-300">{{ complaint.linked_task }}</span>
                {% else %}
                  <span class="text-xs text-amber-300">Awaiting conversion</span>
                {% endif %}
              </td>
              <td class="px-4 py-4">
                <div class="flex items-center gap-2">
                  <a href="#" class="inline-flex h-9 w-9 items-center justify-center rounded-lg border border-emerald-500/40 bg-emerald-500/10 text-emerald-200 transition hover:bg-emerald-500/20" title="View complaint {{ complaint.id }}">
                    <span class="sr-only">View complaint {{ complaint.id }}</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4">
                      <path d="M10 3c-3.978 0-7.36 2.69-8.5 6.45a1.22 1.22 0 000 .9C2.64 14.11 6.022 16.8 10 16.8s7.36-2.69 8.5-6.45a1.22 1.22 0 000-.9C17.36 5.69 13.978 3 10 3zm0 11.3c-2.48 0-4.5-1.95-4.5-4.35S7.52 5.6 10 5.6s4.5 1.95 4.5 4.35-2.02 4.35-4.5 4.35zm0-7a2.65 2.65 0 100 5.3 2.65 2.65 0 000-5.3z" />
                    </svg>
                  </a>
                </div>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="9" class="px-6 py-8 text-center text-sm text-slate-400">No complaints visible to Service right now.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock %}

{% extends "base.html" %}
{% block title %}Eleva ERP – Customers – {{ customer.company_name }}{% endblock %}

{% block content %}
<div class="space-y-8">
  <header class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-400"><a href="{{ url_for('service_customers') }}" class="text-emerald-200 hover:text-emerald-100">Customers</a> · Profile</p>
      <h1 class="text-2xl font-semibold text-theme-primary">{{ customer.company_name }}</h1>
      <p class="text-sm text-slate-400">Customer code {{ customer.customer_code }} · {{ customer.route or 'Route not set' }}</p>
    </div>
    <div class="flex gap-2">
      <a href="{{ url_for('service_lifts') }}?q={{ customer.customer_code }}" class="rounded-xl border border-emerald-500/40 bg-emerald-500/10 px-3 py-2 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/20">View lifts</a>
    </div>
  </header>

  <div class="grid gap-6 lg:grid-cols-[2fr,1.25fr]">
    <form method="post" action="{{ url_for('service_customer_update', customer_id=customer.id) }}" class="space-y-5 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 text-sm text-slate-100">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="text-lg font-semibold text-theme-primary">Customer details</h2>
          <p class="text-xs text-slate-400">Update routing, billing and contact information.</p>
        </div>
        <button type="submit" class="rounded-xl border border-emerald-500/40 bg-emerald-500/20 px-4 py-2 text-xs font-semibold text-emerald-100 hover:bg-emerald-500/30">Save changes</button>
      </div>
      <div class="grid gap-4 md:grid-cols-2">
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Customer code</span>
          <input name="customer_code" value="{{ customer.customer_code }}" required class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Company name</span>
          <input name="company_name" value="{{ customer.company_name }}" required class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Contact person</span>
          <input name="contact_person" value="{{ customer.contact_person or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Email</span>
          <input type="email" name="email" value="{{ customer.email or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Phone</span>
          <input name="phone" value="{{ customer.phone or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Mobile</span>
          <input name="mobile" value="{{ customer.mobile or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Route</span>
          <input name="route" value="{{ customer.route or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Sector</span>
          <input name="sector" value="{{ customer.sector or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Branch</span>
          <input name="branch" value="{{ customer.branch or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">GST number</span>
          <input name="gst_no" value="{{ customer.gst_no or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
      </div>
      <div class="grid gap-4 md:grid-cols-2">
        <label class="space-y-1 md:col-span-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Billing address line 1</span>
          <input name="billing_address_line1" value="{{ customer.billing_address_line1 or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1 md:col-span-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Billing address line 2</span>
          <input name="billing_address_line2" value="{{ customer.billing_address_line2 or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">City</span>
          <input name="city" value="{{ customer.city or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">State</span>
          <input name="state" value="{{ customer.state or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Pincode</span>
          <input name="pincode" value="{{ customer.pincode or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
        <label class="space-y-1">
          <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Country</span>
          <input name="country" value="{{ customer.country or '' }}" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2" />
        </label>
      </div>
      <label class="space-y-1">
        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Notes</span>
        <textarea name="notes" rows="3" class="w-full rounded-xl border border-slate-700 bg-slate-800/70 px-3 py-2">{{ customer.notes or '' }}</textarea>
      </label>
    </form>

    <section class="space-y-4 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 text-sm text-slate-100">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-lg font-semibold text-theme-primary">Account summary</h2>
          <p class="text-xs text-slate-400">Snapshot of linked lifts and billing details.</p>
        </div>
        <div class="text-right text-xs text-slate-400">
          <div>Created {{ customer.created_at.strftime('%d %b %Y') if customer.created_at else '—' }}</div>
          <div>Updated {{ customer.updated_at.strftime('%d %b %Y %H:%M') if customer.updated_at else '—' }}</div>
        </div>
      </div>
      <dl class="grid gap-4">
        <div class="flex justify-between">
          <dt class="text-slate-400">Email</dt>
          <dd class="font-semibold text-slate-200">{{ customer.email or '—' }}</dd>
        </div>
        <div class="flex justify-between">
          <dt class="text-slate-400">Phone</dt>
          <dd class="font-semibold text-slate-200">{{ customer.phone or '—' }}</dd>
        </div>
        <div class="flex justify-between">
          <dt class="text-slate-400">Mobile</dt>
          <dd class="font-semibold text-slate-200">{{ customer.mobile or '—' }}</dd>
        </div>
        <div class="flex justify-between">
          <dt class="text-slate-400">Route</dt>
          <dd class="font-semibold text-slate-200">{{ customer.route or '—' }}</dd>
        </div>
        <div class="flex justify-between">
          <dt class="text-slate-400">Branch</dt>
          <dd class="font-semibold text-slate-200">{{ customer.branch or '—' }}</dd>
        </div>
      </dl>
      <div class="rounded-xl border border-slate-800/80 bg-slate-900/80 p-4 text-xs text-slate-300">
        <h3 class="text-sm font-semibold text-slate-100">Billing address</h3>
        <p class="mt-1 whitespace-pre-line">{{ (customer.billing_address_line1 or '') ~ '\n' ~ (customer.billing_address_line2 or '') }}</p>
        <p>{{ customer.city or '' }}{{ ', ' if customer.city and customer.state }}{{ customer.state or '' }} {{ customer.pincode or '' }}</p>
        <p>{{ customer.country or '' }}</p>
      </div>
      <div class="rounded-xl border border-slate-800/80 bg-slate-900/80 p-4 text-xs text-slate-300">
        <h3 class="text-sm font-semibold text-slate-100">Notes</h3>
        <p class="mt-2 text-slate-200">{{ customer.notes or '—' }}</p>
      </div>
    </section>
  </div>

  <section class="space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-theme-primary">Linked lifts</h2>
      <a href="{{ url_for('service_lifts') }}?q={{ customer.customer_code }}" class="rounded-xl border border-slate-700/70 px-3 py-1 text-xs text-slate-200 hover:bg-slate-800/70">Manage lifts</a>
    </div>
    <div class="rounded-2xl border border-slate-800 bg-slate-900/60">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-800 text-sm">
          <thead class="bg-slate-900/80 text-xs uppercase tracking-wide text-slate-400">
            <tr>
              <th class="px-4 py-3 text-left">Lift code</th>
              <th class="px-4 py-3 text-left">Type</th>
              <th class="px-4 py-3 text-left">Route</th>
              <th class="px-4 py-3 text-left">Status</th>
              <th class="px-4 py-3 text-left">Install date</th>
              <th class="px-4 py-3 text-left">Last service</th>
              <th class="px-4 py-3 text-left">Next due</th>
              <th class="px-4 py-3 text-left">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-800/80 text-slate-200">
            {% for lift in lifts %}
              <tr class="hover:bg-slate-800/40">
                <td class="px-4 py-3 font-semibold text-theme-primary">{{ lift.lift_code }}</td>
                <td class="px-4 py-3">{{ lift.lift_type or '—' }}</td>
                <td class="px-4 py-3">{{ lift.route or '—' }}</td>
                <td class="px-4 py-3">{{ lift.status or '—' }}</td>
                <td class="px-4 py-3">{{ lift.install_date.strftime('%d %b %Y') if lift.install_date else '—' }}</td>
                <td class="px-4 py-3">{{ lift.last_service_date.strftime('%d %b %Y') if lift.last_service_date else '—' }}</td>
                <td class="px-4 py-3">{{ lift.next_service_due.strftime('%d %b %Y') if lift.next_service_due else '—' }}</td>
                <td class="px-4 py-3">
                  <a href="{{ url_for('service_lift_edit', lift_id=lift.id) }}" class="rounded-lg border border-slate-700/70 px-3 py-1 text-xs text-slate-200 hover:bg-slate-800/70">Open</a>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="8" class="px-4 py-6 text-center text-sm text-slate-400">No lifts linked yet. Create a lift and assign it to this customer to see it here.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </section>
</div>
{% endblock %}
